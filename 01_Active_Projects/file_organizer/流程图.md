# file_organizer.py 程序流程图

> 用可视化方式理解程序的工作流程

---

## 🎯 整体流程图

```
┌─────────────────────────────────────┐
│          开始运行程序               │
│     python file_organizer.py       │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│         main() 主函数               │
│   创建 FileOrganizer 对象           │
│   organizer = FileOrganizer()      │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│      __init__() 初始化方法          │
│   自动执行（创建对象时）            │
│                                     │
│  1. 加载配置文件 config.json        │
│     ↓                              │
│  2. 初始化统计信息 stats            │
│     - 总文件数: 0                   │
│     - 成功移动: 0                   │
│     - 申请人统计: {}                │
│     - 材料类型统计: {}              │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│    organizer.organize() 执行整理    │
│                                     │
│  ┌──────────────────────────────┐  │
│  │ 步骤1: 获取今天的日期        │  │
│  │ today = "2025-01-08"         │  │
│  └──────────┬───────────────────┘  │
│             │                      │
│             ▼                      │
│  ┌──────────────────────────────┐  │
│  │ 步骤2: 扫描源文件夹          │  │
│  │ for folder in source_folders │  │
│  │   Desktop/                   │  │
│  │   Downloads/                 │  │
│  │   ↓                          │  │
│  │   scan_folder(folder)        │  │
│  │     找到所有文件             │  │
│  └──────────┬───────────────────┘  │
│             │                      │
│             ▼                      │
│  ┌──────────────────────────────┐  │
│  │ 步骤3: 处理每个文件          │  │
│  │ for file in all_files:       │  │
│  │   ↓                           │  │
│  │   1. identify_file(filename) │  │
│  │      识别申请人和材料类型     │  │
│  │      ↓                       │  │
│  │   2. get_archive_path(...)   │  │
│  │      生成归档路径             │  │
│  │      ↓                       │  │
│  │   3. move_file(...)          │  │
│  │      移动文件到归档位置       │  │
│  │      ↓                       │  │
│  │   4. 更新统计信息            │  │
│  └──────────┬───────────────────┘  │
│             │                      │
│             ▼                      │
│  ┌──────────────────────────────┐  │
│  │ 步骤4: 生成报告              │  │
│  │ generate_report(today)       │  │
│  │   显示统计信息                │  │
│  └──────────┬───────────────────┘  │
│             │                      │
└─────────────┼──────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│           程序结束                  │
│      [完成] 整理完成！              │
└─────────────────────────────────────┘
```

---

## 📁 文件扫描流程 (scan_folder)

```
┌─────────────────────────────────┐
│  scan_folder(folder_path)       │
│  扫描指定文件夹                  │
└────────────┬────────────────────┘
             │
             ▼
    ┌────────────────┐
    │ os.listdir()   │
    │ 列出所有项目    │
    └────────┬───────┘
             │
             ▼
    ┌────────────────┐
    │ 遍历每个项目    │
    └────┬──────┬────┘
         │      │
         ▼      ▼
    ┌─────┐  ┌─────┐
    │文件?│  │文件夹│
    └──┬──┘  └──┬──┘
       │ Yes     │ No
       │         │ (跳过)
       ▼
    ┌────────────────┐
    │ 检查扩展名      │
    │ os.splitext()  │
    └────┬──────┬────┘
         │      │
         ▼      ▼
    ┌────────┐ ┌────────┐
    │白名单? │ │不在白名单│
    │.pdf    │ │.txt    │
    │.jpg    │ └────┬───┘
    │.docx   │      │ (跳过)
    └────┬───┘       │
         │ Yes        │
         ▼            │
    ┌────────────────┐
    │ 添加到列表      │
    │ files.append() │
    └────────────────┘
             │
             ▼
    ┌────────────────┐
    │ 返回文件列表    │
    │ return files   │
    └────────────────┘
```

---

## 🧠 文件识别流程 (identify_file)

```
┌─────────────────────────────────┐
│  identify_file(filename)        │
│  智能识别文件                    │
└────────────┬────────────────────┘
             │
             ▼
    ┌─────────────────┐
    │ 去掉扩展名       │
    │ os.splitext()   │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 检查分隔符       │
    └────┬────┬───────┘
         │    │
         ▼    ▼
    ┌─────────┐ ┌──────────┐
    │有'_'?  │ │有'-'?    │
    │下划线   │ │横杠      │
    └────┬────┘ └────┬─────┘
         │Yes        │Yes
         ▼           ▼
    ┌────────────────┐
    │ split('_') 或   │
    │ split('-')      │
    │ 提取第一部分     │
    │ 作为申请人       │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────────────┐
    │ 遍历材料类型关键词       │
    │ for type, keywords in   │
    │     file_patterns.items()│
    └──────────┬──────────────┘
               │
               ▼
    ┌────────────────┐
    │ '身份证' in ... │
    │ '申请表' in ... │
    │ '租赁' in ...   │
    └────┬──────┬────┘
         │      │
         ▼      ▼
    ┌─────────┐ ┌────────┐
    │匹配到   │ │未匹配  │
    │记录类型 │ │其他材料│
    └────┬────┘ └────┬───┘
         │           │
         ▼           │
    ┌────────────────┐
    │ 返回            │
    │ (申请人, 材料类型)│
    └────────────────┘
```

---

## 📂 文件移动流程 (move_file)

```
┌─────────────────────────────────┐
│  move_file(src_path, dest_folder)│
│  移动文件到目标文件夹              │
└────────────┬────────────────────┘
             │
             ▼
    ┌─────────────────┐
    │ 创建目标文件夹   │
    │ os.makedirs()   │
    │ exist_ok=True   │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 拼接完整路径     │
    │ os.path.join()  │
    │ dest_path       │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ shutil.move()   │
    │ 移动文件         │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 返回 True/False │
    │ 成功/失败        │
    └─────────────────┘
```

---

## 🔄 数据流程图

```
┌──────────┐     ┌──────────┐     ┌──────────┐
│ 配置文件  │────→│   类     │────→│  统计    │
│config.json│ 加载│FileOrganizer│ 更新│  数据    │
└──────────┘     └──────────┘     └──────────┘
                     │
                     │ 处理
                     ▼
              ┌──────────┐
              │ 文件列表  │
              │ all_files │
              └──────────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ▼           ▼           ▼
    ┌─────────┐ ┌─────────┐ ┌─────────┐
    │扫描文件  │ │识别文件  │ │移动文件  │
    │scan()   │ │identify()│ │move()   │
    └─────────┘ └─────────┘ └─────────┘
         │           │           │
         └───────────┼───────────┘
                     │
                     ▼
              ┌──────────┐
              │  整理报告  │
              │ report() │
              └──────────┘
```

---

## 🎨 完整工作流程图（彩色版）

```
           开始
            │
            ▼
    ┌───────────────┐
    │ 创建FileOrganizer│
    │      对象       │
    └───────┬───────┘
            │
            ▼
    ┌───────────────┐
    │  加载配置文件   │━━━━━━━━━━━
    │  config.json   │  配置数据
    └───────┬───────┘
            │
            ▼
    ┌───────────────┐
    │  获取今天日期   │
    └───────┬───────┘
            │
            ▼
    ┌───────────────┐
    │  扫描源文件夹   │
    │  Desktop/      │
    │  Downloads/    │
    └───────┬───────┘
            │
            ▼
    ┌─────────────────────────┐
    │      找到所有文件         │
    │  all_files = [文件列表]   │
    └───────┬─────────────────┘
            │
            ▼
    ┌─────────────────────────┐
    │      遍历每个文件         │
    │  for file in all_files:  │
    └───────┬─────────────────┘
            │
            ▼
    ┌───────────────┐
    │  识别文件类型   │
    │  identify_file()│
    └───────┬───────┘
            │
            ├──► 申请人: 张三
            └──► 材料类型: 身份证
            │
            ▼
    ┌───────────────┐
    │  生成归档路径   │
    │  get_archive...│
    └───────┬───────┘
            │
            ▼
    C:/工作文档/证照档案/
         2025-01-08/
              张三/
            │
            ▼
    ┌───────────────┐
    │   移动文件      │
    │   move_file()  │
    └───────┬───────┘
            │
            ▼
    ┌───────────────┐
    │   更新统计      │
    │   stats += 1   │
    └───────────────┘
            │
            │ (处理完所有文件)
            ▼
    ┌───────────────┐
    │   生成报告      │
    │  generate_...  │
    └───────┬───────┘
            │
            ▼
    ┌───────────────┐
    │   [完成] 整理完成│
    └───────────────┘
            │
            ▼
           结束
```

---

## 📊 类的结构图

```
┌─────────────────────────────────────┐
│         FileOrganizer (类)           │
│                                     │
│  属性 (数据):                        │
│  ├─ config: {}        # 配置信息    │
│  └─ stats: {}         # 统计信息    │
│                                     │
│  方法 (功能):                        │
│  ├─ __init__()        # 初始化      │
│  ├─ load_config()     # 加载配置    │
│  ├─ scan_folder()     # 扫描文件    │
│  ├─ identify_file()   # 识别文件    │
│  ├─ get_archive_path()# 生成路径    │
│  ├─ move_file()       # 移动文件    │
│  ├─ organize()        # 主流程      │
│  └─ generate_report() # 生成报告    │
└─────────────────────────────────────┘
              │ 创建
              ▼
┌─────────────────────────────────────┐
│         organizer (对象)             │
│                                     │
│  具体数据:                           │
│  ├─ config = {...}     # 实际配置   │
│  └─ stats = {...}      # 实际统计   │
└─────────────────────────────────────┘
```

---

## 🔑 关键流程说明

### 1️⃣ 初始化流程

```python
organizer = FileOrganizer('config.json')
```

**发生了什么**：
1. 创建 FileOrganizer 对象
2. 自动调用 `__init__('config.json')`
3. 加载配置文件 → self.config
4. 初始化统计 → self.stats

---

### 2️⃣ 扫描流程

```python
files = organizer.scan_folder('C:/Users/Desktop')
```

**发生了什么**：
1. 列出文件夹所有项目
2. 检查每个项目是否是文件
3. 检查扩展名是否在白名单
4. 返回符合条件的文件列表

---

### 3️⃣ 识别流程

```python
applicant, material = organizer.identify_file('张三_身份证.jpg')
```

**发生了什么**：
1. 分割文件名: '张三_身份证.jpg' → ['张三', '身份证.jpg']
2. 提取申请人: '张三'
3. 匹配材料类型: '身份证'
4. 返回: ('张三', '身份证')

---

### 4️⃣ 移动流程

```python
organizer.move_file('C:/Desktop/张三_身份证.jpg', 'C:/档案/张三/')
```

**发生了什么**：
1. 创建目标文件夹: C:/档案/张三/
2. 移动文件: Desktop → 档案
3. 返回成功状态

---

## 💡 理解要点

### **程序的三大步骤**

1. **扫描** → 找到文件
2. **识别** → 理解文件
3. **移动** → 整理文件

### **数据流转**

```
配置文件 → 类对象 → 文件列表 → 识别结果 → 移动操作 → 统计报告
```

### **类的优势**

- **封装**: 所有相关功能放在一起
- **复用**: 可以创建多个独立对象
- **组织**: 代码结构清晰易懂

---

**看完这个流程图，您理解程序的工作原理了吗？** 😊

如果还有疑问，告诉我哪个部分不清楚，我可以进一步解释！
