# supervisor.py ä»£ç æ³¨é‡Šè¯´æ˜

## ğŸ“– æ¦‚è¿°

`supervisor.py` æ˜¯ä¸€ä¸ªåŸºäºå¤šAgentåä½œæ¨¡å¼çš„ç½‘é¡µè‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œé‡‡ç”¨ç›‘ç£è€…ï¼ˆSupervisorï¼‰æ¨¡å¼åè°ƒå¤šä¸ªä¸“é—¨çš„Agentå®Œæˆå¤æ‚çš„ä¸šåŠ¡æµç¨‹ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### Agentåä½œé“¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LoginAgent  â”‚ â”€â”€â”€â†’ â”‚  FormAgent  â”‚ â”€â”€â”€â†’ â”‚  FileAgent  â”‚ â”€â”€â”€â†’ â”‚ ValidationAgent  â”‚
â”‚  (ç™»å½•)     â”‚      â”‚  (å¡«è¡¨)     â”‚      â”‚  (æ–‡ä»¶)     â”‚      â”‚    (éªŒè¯)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                                                           â”‚
       â”‚                                                           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AutomationSupervisor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (ç›‘ç£è€… - åè°ƒæ‰€æœ‰Agent)
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ |
|------|------|
| `BaseAutomationAgent` | AgentåŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€çš„æ¥å£ |
| `AutomationAgentType` | Agentç±»å‹æšä¸¾ |
| `AgentResponse` | ç»Ÿä¸€çš„å“åº”æ ¼å¼ |
| `AutomationSupervisor` | ç›‘ç£è€…ï¼Œåè°ƒAgentæ‰§è¡Œ |

---

## ğŸ“ æ³¨é‡Šè¯¦æƒ…

### 1. BaseAutomationAgent (åŸºç¡€Agentç±»)

**æ³¨é‡Šä½ç½®**: ç¬¬85-118è¡Œ

**æ ¸å¿ƒæ–¹æ³•**: `execute(input_data)`

**æ³¨é‡Šå†…å®¹**:
- æ–¹æ³•ç”¨é€”ï¼šæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°
- è¾“å…¥å‚æ•°è¯¦è§£ï¼špage, browser, context, config, workflow_state
- è¿”å›å€¼ç»“æ„ï¼šsuccess, data, error, next_agent, message

### 2. LoginAgent (ç™»å½•Agent)

**æ³¨é‡Šä½ç½®**: ç¬¬120-202è¡Œ

**å·¥ä½œæµç¨‹**:
1. è®¿é—®ç™»å½•é¡µé¢
2. å¡«å†™ç”¨æˆ·åå’Œå¯†ç 
3. ç‚¹å‡»ç™»å½•æŒ‰é’®
4. éªŒè¯ç™»å½•æ˜¯å¦æˆåŠŸï¼ˆé€šè¿‡URLå˜åŒ–åˆ¤æ–­ï¼‰
5. è¿”å›æ‰§è¡Œç»“æœ

**è¾“å…¥æ•°æ®**: url, username, password, page
**è¿”å›ç»“æœ**: success=True â†’ next_agent="form_agent"

### 3. FormAgent (è¡¨å•Agent)

**æ³¨é‡Šä½ç½®**: ç¬¬204-295è¡Œ

**å·¥ä½œæµç¨‹**:
1. ç­‰å¾…è¡¨å•å…ƒç´ åŠ è½½å®Œæˆ
2. éå†è¡¨å•æ•°æ®å­—å…¸
3. æ™ºèƒ½è¯†åˆ«å…ƒç´ ç±»å‹ï¼ˆä¸‹æ‹‰æ¡†/è¾“å…¥æ¡†ï¼‰
4. ä½¿ç”¨å¤šç§é€‰æ‹©å™¨ç­–ç•¥ï¼ˆID/nameå±æ€§ï¼‰
5. æˆªå›¾ä¿å­˜å¡«å†™ç»“æœ
6. è¿”å›æ‰§è¡Œç»Ÿè®¡

**é€‰æ‹©å™¨ç­–ç•¥**:
- ä¼˜å…ˆçº§1: `#å­—æ®µå` (IDé€‰æ‹©å™¨)
- ä¼˜å…ˆçº§2: `select#å­—æ®µå` (ä¸‹æ‹‰æ¡†ä¸“ç”¨)
- ä¼˜å…ˆçº§3: `[name='å­—æ®µå']` (nameå±æ€§é€‰æ‹©å™¨)

### 4. FileAgent (æ–‡ä»¶Agent)

**æ³¨é‡Šä½ç½®**: ç¬¬297-410è¡Œ

**æ”¯æŒçš„æ“ä½œç±»å‹**:
- `upload`: ä¸Šä¼ æ–‡ä»¶åˆ°ç½‘é¡µ
- `save`: ä¿å­˜/æäº¤è¡¨å•ï¼ˆç‚¹å‡»æäº¤æŒ‰é’®ï¼‰
- `download`: ä»ç½‘é¡µä¸‹è½½æ–‡ä»¶

**æ¯ä¸ªæ“ä½œçš„è¯¦ç»†æ³¨é‡Š**:
- uploadæ¨¡å¼: å®šä½æ–‡ä»¶è¾“å…¥æ¡† â†’ è®¾ç½®æ–‡ä»¶è·¯å¾„ â†’ è§¦å‘ä¸Šä¼ 
- saveæ¨¡å¼: ç‚¹å‡»æäº¤æŒ‰é’® â†’ ç­‰å¾…é¡µé¢å“åº”
- downloadæ¨¡å¼: ç›‘å¬ä¸‹è½½äº‹ä»¶ â†’ ç‚¹å‡»ä¸‹è½½æŒ‰é’® â†’ ä¿å­˜æ–‡ä»¶

### 5. ValidationAgent (éªŒè¯Agent)

**æ³¨é‡Šä½ç½®**: ç¬¬412-500è¡Œ

**éªŒè¯é¡¹ç›®**:
1. URLéªŒè¯: æ£€æŸ¥å½“å‰URLæ˜¯å¦åŒ…å«æœŸæœ›çš„å­—ç¬¦ä¸²
2. æ–‡æœ¬éªŒè¯: æ£€æŸ¥é¡µé¢æ˜¯å¦åŒ…å«æœŸæœ›çš„æ–‡æœ¬å†…å®¹
3. é”™è¯¯æ£€æµ‹: æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰é”™è¯¯æç¤ºå…ƒç´ 

**éªŒè¯é€»è¾‘**:
- URLéªŒè¯æˆåŠŸ â†’ æ˜¾ç¤º âœ…
- URLéªŒè¯å¤±è´¥ â†’ æ˜¾ç¤º âŒ
- æ–‡æœ¬éªŒè¯æˆåŠŸ â†’ æ˜¾ç¤º âœ…
- æ–‡æœ¬éªŒè¯å¤±è´¥ â†’ æ˜¾ç¤º âŒ
- å‘ç°é”™è¯¯å…ƒç´  â†’ æ˜¾ç¤º âš ï¸
- æœ€ç»ˆæˆåŠŸæ¡ä»¶: æ²¡æœ‰ âŒ æ ‡è®°çš„éªŒè¯é¡¹

### 6. AutomationSupervisor (ç›‘ç£è€…)

**æ³¨é‡Šä½ç½®**: ç¬¬502-647è¡Œ

**æ ¸å¿ƒæ–¹æ³•**: `execute_workflow(workflow_config)`

**å·¥ä½œæµæ¨¡å¼**: é“¾å¼Agentåä½œ
```
LoginAgent â†’ FormAgent â†’ FileAgent â†’ ValidationAgent
```

**æ‰§è¡Œæµç¨‹**:
1. åˆ›å»ºæµè§ˆå™¨é¡µé¢
2. ä»login_agentå¼€å§‹æ‰§è¡Œ
3. æ¯ä¸ªAgentè¿”å›åï¼Œæ£€æŸ¥æ˜¯å¦æˆåŠŸ
4. æ ¹æ®next_agentå­—æ®µå†³å®šä¸‹ä¸€ä¸ªæ‰§è¡Œçš„Agent
5. é‡å¤æ­¥éª¤3-4ï¼Œç›´åˆ°æ²¡æœ‰ä¸‹ä¸€ä¸ªAgent
6. è¿”å›æœ€ç»ˆæ‰§è¡Œç»“æœ

**å®‰å…¨æœºåˆ¶**:
- æœ€å¤§è¿­ä»£æ¬¡æ•°: 10æ¬¡ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰
- å¼‚å¸¸æ•è·: ä»»ä½•Agentå¤±è´¥éƒ½ä¼šç»ˆæ­¢å·¥ä½œæµ
- è¯¦ç»†æ—¥å¿—: è®°å½•æ¯æ­¥æ‰§è¡Œç»“æœ

### 7. main() æµ‹è¯•å…¥å£

**æ³¨é‡Šä½ç½®**: ç¬¬654-736è¡Œ

**æµ‹è¯•åœºæ™¯**: åœ¨æœ¬åœ°æµ‹è¯•ç½‘ç«™ (http://127.0.0.1:5555) ä¸Šæ‰§è¡Œå®Œæ•´çš„ç™»å½•-å¡«è¡¨-æäº¤æµç¨‹

**å‰ç½®æ¡ä»¶**:
1. éœ€è¦å…ˆå¯åŠ¨æµ‹è¯•ç½‘ç«™: `python test_site/server.py`
2. æµ‹è¯•ç½‘ç«™åº”è¯¥åœ¨ http://127.0.0.1:5555 ç›‘å¬

**æ‰§è¡Œæµç¨‹**:
1. å¯åŠ¨Playwrightæµè§ˆå™¨ï¼ˆéæ— å¤´æ¨¡å¼ï¼Œä¾¿äºè§‚å¯Ÿï¼‰
2. åˆ›å»ºAutomationSupervisorå®ä¾‹
3. é…ç½®å·¥ä½œæµå‚æ•°
4. æ‰§è¡Œå·¥ä½œæµ
5. æ‰“å°æ‰§è¡Œç»“æœ
6. å…³é—­æµè§ˆå™¨

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### è¿è¡Œæµ‹è¯•

```bash
# 1. å¯åŠ¨æµ‹è¯•ç½‘ç«™
python test_site/server.py

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œç›‘ç£è€…
python automation_agents/supervisor.py
```

### è‡ªå®šä¹‰å·¥ä½œæµ

```python
# åˆ›å»ºç›‘ç£è€…
supervisor = AutomationSupervisor()

# é…ç½®å·¥ä½œæµ
workflow_config = {
    "browser": browser,
    "url": "https://example.com/login",
    "username": "your_username",
    "password": "your_password",
    "form_data": {
        "field1": "value1",
        "field2": "value2"
    }
}

# æ‰§è¡Œå·¥ä½œæµ
result = await supervisor.execute_workflow(workflow_config)
```

---

## ğŸ“š æ‰©å±•Agent

### åˆ›å»ºè‡ªå®šä¹‰Agent

```python
class MyCustomAgent(BaseAutomationAgent):
    """è‡ªå®šä¹‰Agent"""

    def __init__(self):
        super().__init__("MyCustomAgent", AutomationAgentType.CUSTOM)

    async def execute(self, input_data: Dict[str, Any]) -> AgentResponse:
        """
        æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡

        å‚æ•°:
            input_data: è¾“å…¥æ•°æ®

        è¿”å›:
            AgentResponse: æ‰§è¡Œç»“æœ
        """
        try:
            # å®ç°ä½ çš„é€»è¾‘
            page = input_data.get("page")

            # æ‰§è¡Œæ“ä½œ...

            return AgentResponse(
                success=True,
                message="æ“ä½œæˆåŠŸ",
                next_agent="ä¸‹ä¸€ä¸ªAgentåç§°"  # æˆ– None è¡¨ç¤ºç»“æŸ
            )

        except Exception as e:
            return AgentResponse(
                success=False,
                error=f"æ“ä½œå¤±è´¥: {str(e)}"
            )
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

1. **å¯ç”¨éæ— å¤´æ¨¡å¼**: `headless=False` è§‚å¯Ÿæµè§ˆå™¨æ“ä½œ
2. **æ”¾æ…¢æ“ä½œé€Ÿåº¦**: `slow_mo=500` å»¶è¿Ÿ500ms
3. **æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—**: æ£€æŸ¥ `execution_log` æ•°ç»„
4. **æˆªå›¾éªŒè¯**: ä½¿ç”¨ `screenshot_path` ä¿å­˜æˆªå›¾
5. **é€æ­¥æµ‹è¯•**: å•ç‹¬æµ‹è¯•æ¯ä¸ªAgent

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-16
**ä½œè€…**: Claude Code
