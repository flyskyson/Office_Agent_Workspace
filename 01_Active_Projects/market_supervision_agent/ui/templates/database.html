{% extends "base.html" %}

{% block title %}æ•°æ®åº“ç®¡ç† - å¸‚åœºç›‘ç®¡æ™ºèƒ½ä½“ v4.0{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†</h2>
    <p class="text-muted">æŸ¥çœ‹å’Œæœç´¢ç»è¥æˆ·æ•°æ®è®°å½•</p>

    <!-- æœç´¢è¡¨å• -->
    <form method="GET" action="{{ url_for('database_page') }}" style="margin-top: 1.5rem;">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 250px;">
                <input type="text" name="keyword" class="form-control" placeholder="æœç´¢å§“åã€åº—åæˆ–èº«ä»½è¯å·..." value="{{ search_term }}">
            </div>
            <div style="width: 150px;">
                <select name="limit" class="form-control">
                    <option value="20" {% if limit == 20 %}selected{% endif %}>20 æ¡</option>
                    <option value="50" {% if limit == 50 %}selected{% endif %}>50 æ¡</option>
                    <option value="100" {% if limit == 100 %}selected{% endif %}>100 æ¡</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">æœç´¢</button>
            {% if search_term %}
            <a href="{{ url_for('database_page') }}" class="btn btn-secondary">æ¸…é™¤</a>
            {% endif %}
        </div>
    </form>
</div>

<!-- æ•°æ®ç»Ÿè®¡ -->
<div style="margin-top: 1.5rem;">
    {% if search_term %}
    <div class="alert alert-info">
        æ‰¾åˆ° <strong>{{ operators|length }}</strong> æ¡åŒ¹é… "{{ search_term }}" çš„è®°å½•
    </div>
    {% else %}
    <div class="alert alert-success">
        å…± <strong>{{ operators|length }}</strong> æ¡è®°å½•
    </div>
    {% endif %}
</div>

<!-- æ•°æ®è¡¨æ ¼ -->
{% if operators %}
<div class="card" style="padding: 0; overflow-x: auto;">
    <table class="table" style="margin: 0;">
        <thead>
            <tr>
                <th>ID</th>
                <th>å§“å</th>
                <th>èº«ä»½è¯å·</th>
                <th>æ€§åˆ«</th>
                <th>åº—å</th>
                <th>ç”µè¯</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for op in operators %}
            <tr>
                <td>{{ op.id }}</td>
                <td><strong>{{ op.operator_name or '-' }}</strong></td>
                <td>{{ op.id_card or '-' }}</td>
                <td>{{ op.gender or '-' }}</td>
                <td>{{ op.business_name or '-' }}</td>
                <td>{{ op.phone or '-' }}</td>
                <td style="font-size: 0.9rem; color: #6c757d;">{{ op.created_at or '-' }}</td>
                <td>
                    <a href="{{ url_for('edit_page', operator_id=op.id) }}"
                       class="btn btn-sm btn-primary">
                        âœï¸ ç¼–è¾‘
                    </a>
                    <form method="POST" action="{{ url_for('delete_operator', operator_id=op.id) }}"
                          style="display: inline; margin-left: 0.5rem;"
                          onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è®°å½• {{ op.operator_name }} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼');">
                        <button type="submit" class="btn btn-sm btn-danger">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- åˆ†é¡µæç¤º -->
<div class="card" style="background: #f8f9fa; box-shadow: none;">
    <p class="text-muted">
        {% if search_term %}
        æ˜¾ç¤ºæœç´¢ç»“æœï¼ˆæœ€å¤š {{ limit }} æ¡ï¼‰
        {% else %}
        æ˜¾ç¤ºæœ€è¿‘ {{ limit }} æ¡è®°å½•
        {% endif %}
    </p>
</div>
{% else %}
<div class="alert alert-warning">
    <h4>æš‚æ— æ•°æ®</h4>
    <p>æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰è®°å½•ã€‚è¯·å…ˆ<a href="{{ url_for('upload_page') }}">ä¸Šä¼ æ–‡ä»¶</a>è¿›è¡Œ OCR è¯†åˆ«ã€‚</p>
</div>
{% endif %}

<!-- æ“ä½œæŒ‰é’® -->
<div style="margin-top: 2rem;">
    <a href="{{ url_for('upload_page') }}" class="btn btn-primary">ä¸Šä¼ æ–‡ä»¶</a>
    {% if operators %}
    <a href="{{ url_for('generate_page') }}" class="btn btn-success">ç”Ÿæˆç”³è¯·ä¹¦</a>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
.table {
    font-size: 0.95rem;
}

.table th {
    position: sticky;
    top: 0;
    background: #f8f9fa !important;
    z-index: 10;
}

.table td {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.875rem;
    border-radius: 4px;
    text-decoration: none;
    display: inline-block;
    transition: all 0.2s;
}

.btn-sm:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn-danger {
    background-color: #dc3545;
    color: white;
    border: none;
    cursor: pointer;
}

.btn-danger:hover {
    background-color: #c82333;
}
</style>
{% endblock %}
