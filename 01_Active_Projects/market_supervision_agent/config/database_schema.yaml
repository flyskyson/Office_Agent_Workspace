# 数据库结构定义 - 市场监管智能体 v4.0

# 表结构
tables:
  operators:
    description: "经营户档案表"
    fields:
      # 主键和 timestamps
      id:
        type: INTEGER
        primary_key: true
        autoincrement: true
        description: "记录ID"

      created_at:
        type: TIMESTAMP
        default: CURRENT_TIMESTAMP
        description: "创建时间"

      updated_at:
        type: TIMESTAMP
        default: CURRENT_TIMESTAMP
        description: "更新时间"

      # 基本信息
      operator_name:
        type: TEXT
        required: true
        description: "经营者姓名"

      id_card:
        type: TEXT
        unique: true
        required: true
        description: "身份证号"

      phone:
        type: TEXT
        description: "联系电话"

      email:
        type: TEXT
        description: "电子邮箱"

      gender:
        type: TEXT
        description: "性别"

      nation:
        type: TEXT
        description: "民族"

      address:
        type: TEXT
        description: "地址"

      # 经营信息
      business_name:
        type: TEXT
        description: "个体工商户名称"

      business_address:
        type: TEXT
        description: "经营场所"

      business_scope:
        type: TEXT
        description: "经营范围"

      credit_code:
        type: TEXT
        description: "统一社会信用代码"

      # 场所信息
      property_owner:
        type: TEXT
        description: "房产所有人/房东"

      lease_start:
        type: DATE
        description: "租赁开始日期"

      lease_end:
        type: DATE
        description: "租赁结束日期"

      rent_amount:
        type: TEXT
        description: "租金金额"

      # 文件路径
      id_card_front_path:
        type: TEXT
        description: "身份证正面路径"

      id_card_back_path:
        type: TEXT
        description: "身份证反面路径"

      business_license_path:
        type: TEXT
        description: "营业执照路径"

      lease_contract_path:
        type: TEXT
        description: "租赁合同路径"

      property_cert_path:
        type: TEXT
        description: "产权证明路径"

      # 归档信息
      archive_path:
        type: TEXT
        description: "归档目录路径"

      # 状态
      status:
        type: TEXT
        default: "active"
        description: "记录状态：active | deleted"

      # 元数据
      metadata:
        type: TEXT
        description: "JSON格式的额外信息"

    indexes:
      - name: "idx_id_card"
        fields: ["id_card"]
        unique: true

      - name: "idx_business_name"
        fields: ["business_name"]

      - name: "idx_operator_name"
        fields: ["operator_name"]

  operation_logs:
    description: "操作日志表"
    fields:
      id:
        type: INTEGER
        primary_key: true
        autoincrement: true

      operator_id:
        type: INTEGER
        foreign_key:
          table: "operators"
          field: "id"
        description: "经营户ID"

      operation:
        type: TEXT
        required: true
        description: "操作类型：insert | update | delete | generate"

      details:
        type: TEXT
        description: "操作详情"

      created_at:
        type: TIMESTAMP
        default: CURRENT_TIMESTAMP
        description: "操作时间"

# 索引定义
indexes:
  - name: "idx_id_card"
    table: "operators"
    columns: ["id_card"]
    unique: true

  - name: "idx_business_name"
    table: "operators"
    columns: ["business_name"]

  - name: "idx_operator_name"
    table: "operators"
    columns: ["operator_name"]

# 数据验证规则
validation:
  id_card:
    pattern: "^[1-9]\\d{5}(18|19|20)\\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])\\d{3}[\\dXx]$"
    description: "18位身份证号"

  phone:
    pattern: "^1[3-9]\\d{9}$"
    description: "手机号"

  credit_code:
    pattern: "^[A-Z0-9]{18}$"
    description: "18位统一社会信用代码"

  email:
    pattern: "^[\\w\\.-]+@[\\w\\.-]+\\.\\w+$"
    description: "电子邮箱"

# 默认值配置
defaults:
  constants:
    postal_code: "537820"
    operation_period: "长期"
    region: "广西壮族自治区玉林市兴业县蒲塘镇"

  business_scope:
    licensed: "小餐饮"
    general: "食品销售（仅销售预包装食品）"
    note_licensed: "（依法须经批准的项目，经相关部门批准后方可开展经营活动，具体经营项目以相关部门批准文件或许可证件为准"
    note_general: "（除依法须经批准的项目外，凭营业执照依法自主开展经营活动）"
