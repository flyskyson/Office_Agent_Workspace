{% extends "base.html" %}

{% block title %}ç”³è¯·ä¹¦ç”Ÿæˆ - å¸‚åœºç›‘ç®¡æ™ºèƒ½ä½“ v4.0{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“„ ç”³è¯·ä¹¦ç”Ÿæˆ</h2>
    <p class="text-muted">é€‰æ‹©ç»è¥æˆ·è®°å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸ªä½“å·¥å•†æˆ·å¼€ä¸šç™»è®°ç”³è¯·ä¹¦</p>
</div>

<!-- é€‰æ‹©ç»è¥æˆ· -->
<div class="card">
    <h3>é€‰æ‹©ç»è¥æˆ·</h3>

    <form method="POST" action="{{ url_for('generate_application') }}">
        <div class="form-group">
            <label for="operator_id">é€‰æ‹©è®°å½•</label>
            <select name="operator_id" id="operator_id" class="form-control" required>
                <option value="">-- è¯·é€‰æ‹© --</option>
                {% for op in operators %}
                <option value="{{ op.id }}">
                    {{ op.operator_name }} - {{ op.business_name or 'æœªå‘½ååº—é“º' }} ({{ op.id_card }})
                </option>
                {% endfor %}
            </select>
            <small class="text-muted">{{ operators|length }} æ¡è®°å½•å¯é€‰</small>
        </div>

        <!-- é€‰ä¸­çš„è®°å½•è¯¦æƒ…é¢„è§ˆ -->
        <div id="operatorDetail" style="display: none; margin-top: 1.5rem;">
            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 5px;">
                <h4>é¢„è§ˆä¿¡æ¯</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1rem;">
                    <div>
                        <strong>å§“å:</strong> <span id="detail_name">-</span><br>
                        <strong>èº«ä»½è¯:</strong> <span id="detail_id">-</span><br>
                        <strong>æ€§åˆ«:</strong> <span id="detail_gender">-</span><br>
                        <strong>æ°‘æ—:</strong> <span id="detail_nation">-</span>
                    </div>
                    <div>
                        <strong>åº—å:</strong> <span id="detail_shop">-</span><br>
                        <strong>åœ°å€:</strong> <span id="detail_address">-</span><br>
                        <strong>ç”µè¯:</strong> <span id="detail_phone">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-top: 1.5rem;">
            <button type="submit" class="btn btn-success btn-lg">ğŸ“„ ç”Ÿæˆç”³è¯·ä¹¦</button>
            <a href="{{ url_for('database_page') }}" class="btn btn-secondary">è¿”å›æ•°æ®åº“</a>
        </div>
    </form>
</div>

<!-- ä½¿ç”¨è¯´æ˜ -->
<div class="card">
    <h3>ä½¿ç”¨è¯´æ˜</h3>
    <ol style="margin-top: 1rem; padding-left: 2rem;">
        <li>ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©è¦ç”Ÿæˆç”³è¯·ä¹¦çš„ç»è¥æˆ·</li>
        <li>æŸ¥çœ‹é¢„è§ˆä¿¡æ¯ç¡®è®¤æ— è¯¯</li>
        <li>ç‚¹å‡»"ç”Ÿæˆç”³è¯·ä¹¦"æŒ‰é’®</li>
        <li>ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ Word æ ¼å¼çš„ç”³è¯·ä¹¦å¹¶ä¸‹è½½</li>
    </ol>

    <div class="alert alert-info" style="margin-top: 1.5rem;">
        <strong>æç¤º:</strong> ç”Ÿæˆçš„ç”³è¯·ä¹¦é‡‡ç”¨æ ‡å‡†æ ¼å¼ï¼ŒåŒ…å«ç»è¥è€…åŸºæœ¬ä¿¡æ¯ã€ç»è¥åœºæ‰€ä¿¡æ¯ã€ç»è¥èŒƒå›´ç­‰å†…å®¹ã€‚ä¸‹è½½åå¯ä»¥è¿›ä¸€æ­¥ç¼–è¾‘å®Œå–„ã€‚
    </div>
</div>

<!-- æ•°æ®å­˜å‚¨ï¼ˆç”¨äº JavaScriptï¼‰ -->
<script>
const operatorsData = [
    {% for op in operators %}
    {
        id: "{{ op.id }}",
        name: "{{ op.operator_name or '' }}",
        id_card: "{{ op.id_card or '' }}",
        gender: "{{ op.gender or '' }}",
        nation: "{{ op.nation or '' }}",
        business_name: "{{ op.business_name or '' }}",
        business_address: "{{ op.business_address or '' }}",
        phone: "{{ op.phone or '' }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
];
</script>
{% endblock %}

{% block extra_js %}
<script>
const select = document.getElementById('operator_id');
const detailDiv = document.getElementById('operatorDetail');

// æ˜¾ç¤ºé€‰ä¸­çš„ç»è¥æˆ·è¯¦æƒ…
select.addEventListener('change', function() {
    const selectedId = this.value;

    if (!selectedId) {
        detailDiv.style.display = 'none';
        return;
    }

    const operator = operatorsData.find(op => op.id === selectedId);
    if (operator) {
        document.getElementById('detail_name').textContent = operator.name || 'N/A';
        document.getElementById('detail_id').textContent = operator.id_card || 'N/A';
        document.getElementById('detail_gender').textContent = operator.gender || 'N/A';
        document.getElementById('detail_nation').textContent = operator.nation || 'N/A';
        document.getElementById('detail_shop').textContent = operator.business_name || 'N/A';
        document.getElementById('detail_address').textContent = operator.business_address || 'N/A';
        document.getElementById('detail_phone').textContent = operator.phone || 'N/A';

        detailDiv.style.display = 'block';
    }
});
</script>
{% endblock %}
