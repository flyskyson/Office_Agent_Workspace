# 证照材料整理工具 - 学习笔记

## 📚 项目总结

**完成日期**: 2025-01-08
**项目类型**: 文件自动化工具
**技术栈**: Python (os, shutil, json, datetime)

---

## 🎯 学习目标

通过这个项目，我学会了：

### ✅ 基础Python知识
1. **类和对象** (Class)
2. **文件操作** (os模块)
3. **文件移动** (shutil模块)
4. **配置文件** (JSON)
5. **日期处理** (datetime)

### ✅ 编程思维
1. **模块化设计** - 每个功能独立
2. **配置和代码分离** - 便于调整
3. **异常处理** - 防止程序崩溃
4. **代码注释** - 便于理解

---

## 🔑 核心知识点详解

### 1. os模块 - 文件和文件夹操作

#### **os.listdir() - 列出文件夹内容**
```python
files = os.listdir('C:/Users/flyskyson/Desktop')
# 返回: ['文件1.pdf', '文件2.jpg', '文件夹1', ...]
```
**用途**: 查看文件夹里有什么

---

#### **os.path.join() - 拼接路径**
```python
path = os.path.join('C:/Desktop', '文件.txt')
# 返回: 'C:/Desktop/文件.txt' (自动处理斜杠)
```
**为什么重要？**
- Windows用反斜杠 `\`
- Linux/Mac用正斜杠 `/`
- `os.path.join()` 自动处理，兼容所有系统！

**对比**（不推荐❌）:
```python
path = 'C:/Desktop' + '/' + '文件.txt'  # 手动拼接，容易出错
```

---

#### **os.path.splitext() - 分离文件名和扩展名**
```python
name, ext = os.path.splitext('文件.txt')
# 返回: ('文件', '.txt')

name, ext = os.path.splitext('张三_身份证.jpg')
# 返回: ('张三_身份证', '.jpg')
```
**用途**: 提取文件扩展名，判断文件类型

---

#### **os.path.isfile() - 检查是否是文件**
```python
if os.path.isfile('C:/Desktop/文件.txt'):
    print("这是文件")
else:
    print("这是文件夹或不存在")
```

---

#### **os.makedirs() - 创建文件夹**
```python
# 创建单个文件夹
os.makedirs('C:/工作文档/档案')

# 创建多级文件夹
os.makedirs('C:/工作文档/档案/2025-01-08/张三')

# exist_ok=True 表示文件夹存在也不报错
os.makedirs('C:/工作文档/档案', exist_ok=True)
```

---

### 2. shutil模块 - 文件移动

#### **shutil.move() - 移动文件**
```python
# 从源位置移动到目标位置
shutil.move('C:/Desktop/文件.txt', 'C:/工作文档/文件.txt')
```

**为什么用shutil而不是os.rename？**
```python
# os.rename 只能在同一磁盘移动
os.rename('C:/文件.txt', 'D:/文件.txt')  # ❌ 可能失败

# shutil.move 可以跨磁盘移动
shutil.move('C:/文件.txt', 'D:/文件.txt')  # ✅ 成功
```

---

### 3. json模块 - 配置文件

#### **读取配置**
```python
import json

# 打开JSON文件
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)  # 转换成Python字典

# 访问配置
print(config['archive_root'])  # 输出: C:/工作文档/证照档案
print(config['file_patterns'])  # 输出: {'申请表': [...], ...}
```

**为什么用JSON？**
- ✅ 人类可读（文本格式）
- ✅ Python原生支持
- ✅ 其他语言也能用（JavaScript、Java等）

---

#### **保存配置**
```python
config = {
    'archive_root': 'C:/工作文档/证照档案',
    'organize_by_date': True
}

# 保存到JSON文件
with open('config.json', 'w', encoding='utf-8') as f:
    json.dump(config, f, ensure_ascii=False, indent=2)

# ensure_ascii=False  支持中文字符
# indent=2            美化格式，便于阅读
```

---

### 4. datetime模块 - 日期处理

#### **获取当前时间**
```python
from datetime import datetime

now = datetime.now()
# 返回: datetime对象 (2025-01-08 17:30:45)
```

---

#### **格式化日期**
```python
now = datetime.now()

# 格式化为字符串
date_str = now.strftime('%Y-%m-%d')  # '2025-01-08'
date_str = now.strftime('%Y%m%d')    # '20250108'
date_str = now.strftime('%Y-%m-%d %H:%M:%S')  # '2025-01-08 17:30:45'
```

**常用格式符号**:
- `%Y`: 年份(4位)  - 2025
- `%m`: 月份      - 01~12
- `%d`: 日期      - 01~31
- `%H`: 小时      - 00~23
- `%M`: 分钟      - 00~59
- `%S`: 秒        - 00~59

---

### 5. 字符串处理

#### **split() - 分割字符串**
```python
# 按下划线分割
filename = '张三_身份证.jpg'
parts = filename.split('_')
# 返回: ['张三', '身份证.jpg']

# 按横杠分割
filename = '李四-身份证.jpg'
parts = filename.split('-')
# 返回: ['李四', '身份证.jpg']
```

---

#### **in - 检查是否包含**
```python
filename = '张三_身份证.jpg'

if '身份证' in filename:
    print('这是身份证文件')

if 'ID' in filename.upper():  # 转大写检查
    print('包含ID')
```

---

#### **lower() / upper() - 大小写转换**
```python
text = 'Hello World'

text.lower()  # 'hello world' (转小写)
text.upper()  # 'HELLO WORLD' (转大写)
```

**用途**: 实现不区分大小写的匹配

---

### 6. 类和对象

#### **定义类**
```python
class FileOrganizer:  # 定义一个类
    """证照材料整理工具"""

    def __init__(self, config_path):
        """初始化方法（创建对象时自动执行）"""
        self.config = self.load_config(config_path)
        self.stats = {}

    def scan_folder(self, folder_path):
        """扫描文件夹"""
        # 方法代码
        pass

    def organize(self):
        """整理文件"""
        pass
```

---

#### **使用类**
```python
# 创建对象（自动调用__init__）
organizer = FileOrganizer('config.json')

# 调用方法
files = organizer.scan_folder('C:/Desktop')
organizer.organize()
```

---

#### **self的作用**
```python
class FileOrganizer:
    def __init__(self):
        self.config = {}      # 实例变量
        self.stats = {}       # 实例变量

    def method1(self):
        # 可以用self访问其他变量和方法
        print(self.config)
        self.method2()

    def method2(self):
        pass
```

**self的含义**: 指向对象自己
- `self.config` - 这个对象的配置
- `self.stats` - 这个对象的统计

---

### 7. 异常处理

#### **try-except 捕获错误**
```python
try:
    # 可能出错的代码
    shutil.move(src, dest)
except FileNotFoundError:
    # 文件不存在时的处理
    print("文件不存在")
except PermissionError:
    # 没有权限时的处理
    print("没有权限")
except Exception as e:
    # 其他所有错误的处理
    print(f"出错: {e}")
```

**为什么重要？**
- 防止程序崩溃
- 提供友好的错误信息
- 记录错误日志

---

## 🏗️ 设计模式

### **配置和代码分离** ⭐重要

```python
# config.json - 配置文件
{
  "archive_root": "C:/工作文档/证照档案",
  "file_patterns": {
    "身份证": ["身份证", "id", "ID"]
  }
}

# file_organizer.py - 代码
config = json.load('config.json')  # 读取配置
archive_path = config['archive_root']  # 使用配置
```

**好处**:
- ✅ 改配置不需要改代码
- ✅ 非程序员也能调整规则
- ✅ 易于维护

---

### **模块化设计**

```python
class FileOrganizer:
    def scan_folder(self):
        """只负责扫描"""
        pass

    def identify_file(self):
        """只负责识别"""
        pass

    def move_file(self):
        """只负责移动"""
        pass
```

**好处**:
- ✅ 每个功能独立
- ✅ 容易测试
- ✅ 改一个不影响其他

---

## 📝 代码规范

### **命名规范**

```python
# 类名: 大驼峰 (PascalCase)
class FileOrganizer:
    pass

# 变量和函数: 小写+下划线 (snake_case)
file_path = 'C:/Desktop/文件.txt'
def scan_folder():
    pass

# 常量: 全大写+下划线
MAX_FILES = 100
DEFAULT_PATH = 'C:/工作文档'
```

---

### **注释规范**

```python
def scan_folder(self, folder_path):
    """
    扫描文件夹，返回所有文件列表

    参数:
        folder_path: 要扫描的文件夹路径

    返回:
        文件路径列表

    示例:
        >>> files = scan_folder('C:/Desktop')
        >>> print(files)
        ['C:/Desktop/文件1.pdf', ...]
    """
    # 代码实现
    pass
```

---

## 🐛 遇到的Bug和解决

### **Bug1: 扩展名检查错误**

```python
# ❌ 错误代码
ext = os.path.splitext(item)[0]  # 这是文件名，不是扩展名！
if ext in allowed_extensions:
    ...

# ✅ 正确代码
ext = os.path.splitext(item)[1]  # [1]才是扩展名
if ext in allowed_extensions:
    ...
```

**教训**: `os.path.splitext()` 返回 `(文件名, 扩展名)`，要用 `[1]` 取扩展名

---

### **Bug2: Windows终端乱码**

```python
# ❌ 包含emoji的代码
print("✅ 成功")  # Windows GBK编码无法显示

# ✅ 使用文字标签
print("[OK] 成功")
```

**解决**: 移除emoji，用文字标签代替

---

## 🎯 进阶方向

### **V2版本建议**
1. **搜索功能** - 快速找到某人的材料
2. **重复检测** - 发现重复文件
3. **备份功能** - 移动前自动备份
4. **GUI界面** - 图形化操作界面

### **V3版本建议**
1. **数据库索引** - SQLite存储文件索引
2. **OCR识别** - 从图片内容识别文字
3. **自动分类** - 用机器学习智能分类
4. **Web界面** - 浏览器访问

---

## 📖 参考资源

### **Python官方文档**
- [os模块](https://docs.python.org/3/library/os.html)
- [shutil模块](https://docs.python.org/3/library/shutil.html)
- [json模块](https://docs.python.org/3/library/json.html)
- [datetime模块](https://docs.python.org/3/library/datetime.html)

### **推荐教程**
- 廖雪峰Python教程
- Python Crash Range (书籍)
- Real Python (网站)

---

## ✍️ 学习心得

### **最有收获的地方**

1. **配置文件的重要性**
   - 以前所有规则都写死在代码里
   - 现在知道应该分离配置和代码
   - 调整规则再也不用改代码了！

2. **面向对象编程**
   - class让代码更有组织
   - self理解了但还不熟练
   - 需要更多练习

3. **错误处理**
   - try-except很有用
   - 能防止程序崩溃
   - 但还不知道怎么记录错误日志

4. **模块化思维**
   - 一个函数只做一件事
   - 代码清晰易读
   - 容易修改和测试

---

### **需要继续学习**

1. ✅ **Python基础语法** - 已掌握
2. ⭐⭐☆☆ **面向对象编程** - 需要更多练习
3. ⭐☆☆☆ **单元测试** - 还没学
4. ⭐☆☆☆ **日志记录** - 还没学
5. ⭐☆☆☆ **数据库** - 还没学

---

## 🚀 下一步计划

### **短期（1周内）**
- [ ] 复习这个项目的关键代码
- [ ] 把识别逻辑改进（支持无分隔符）
- [ ] 添加搜索功能

### **中期（1个月内）**
- [ ] 学习单元测试
- [ ] 学习日志记录
- [ ] 做第2个项目（Excel自动化）

### **长期（3个月内）**
- [ ] 掌握面向对象编程
- [ ] 学习数据库
- [ ] 做一个商业级工具

---

**更新日期**: 2025-01-08
**项目状态**: ✅ MVP完成
**学习评价**: ⭐⭐⭐⭐☆ (非常有收获！)
