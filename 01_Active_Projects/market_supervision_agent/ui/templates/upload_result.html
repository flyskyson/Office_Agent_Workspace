{% extends "base.html" %}

{% block title %}å¤„ç†ç»“æœ - å¸‚åœºç›‘ç®¡æ™ºèƒ½ä½“ v4.0{% endblock %}

{% block content %}
<div class="card">
    <h2>å¤„ç†ç»“æœ</h2>
    <p class="text-muted mb-4">å·²å¤„ç† {{ files|length }} ä¸ªæ–‡ä»¶</p>

    <!-- æå–çš„æ•°æ® -->
    {% if result.extracted_data %}
    <div class="alert alert-success">
        <h4>âœ… æ•°æ®æå–æˆåŠŸ</h4>
    </div>

    <div class="card" style="background: #f8f9fa; box-shadow: none;">
        <h3>ğŸ“‹ æå–çš„æ•°æ®</h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 1.5rem;">
            <div>
                <h4>åŸºæœ¬ä¿¡æ¯</h4>
                <table class="table" style="background: white;">
                    <tr><td><strong>å§“å</strong></td><td>{{ result.extracted_data.operator_name or 'N/A' }}</td></tr>
                    <tr><td><strong>èº«ä»½è¯</strong></td><td>{{ result.extracted_data.id_card or 'N/A' }}</td></tr>
                    <tr><td><strong>æ€§åˆ«</strong></td><td>{{ result.extracted_data.gender or 'N/A' }}</td></tr>
                    <tr><td><strong>æ°‘æ—</strong></td><td>{{ result.extracted_data.nation or 'N/A' }}</td></tr>
                    <tr><td><strong>åœ°å€</strong></td><td>{{ result.extracted_data.address or 'N/A' }}</td></tr>
                </table>
            </div>

            <div>
                <h4>ç»è¥ä¿¡æ¯</h4>
                <table class="table" style="background: white;">
                    <tr><td><strong>åº—å</strong></td><td>{{ result.extracted_data.business_name or 'N/A' }}</td></tr>
                    <tr><td><strong>ç»è¥åœ°å€</strong></td><td>{{ result.extracted_data.business_address or 'N/A' }}</td></tr>
                    <tr><td><strong>ç»è¥èŒƒå›´</strong></td><td>{{ (result.extracted_data.business_scope or 'N/A')[:100] }}</td></tr>
                    <tr><td><strong>ç”µè¯</strong></td><td>{{ result.extracted_data.phone or 'N/A' }}</td></tr>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <h4>â„¹ï¸ å¤„ç†å®Œæˆ</h4>
        <p>æ–‡ä»¶å·²å¤„ç†ï¼Œä½†æ²¡æœ‰æå–åˆ°æ•°æ®ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š</p>
        <ul style="margin-top: 0.5rem; padding-left: 2rem;">
            <li>é€‰æ‹©äº†"è·³è¿‡ OCR è¯†åˆ«"æ¨¡å¼</li>
            <li>å›¾ç‰‡è´¨é‡ä¸ä½³æˆ–æ ¼å¼ä¸æ”¯æŒ</li>
            <li>å›¾ç‰‡ç±»å‹ä¸åœ¨è¯†åˆ«èŒƒå›´å†…</li>
        </ul>
    </div>
    {% endif %}

    <!-- å¤„ç†æ¶ˆæ¯ -->
    {% if result.messages %}
    <div class="card" style="background: #f8f9fa; box-shadow: none;">
        <h3>å¤„ç†æ—¥å¿—</h3>
        {% for message in result.messages %}
            <div class="alert {% if 'æˆåŠŸ' in message %}alert-success{% elif 'å¤±è´¥' in message or 'é”™è¯¯' in message %}alert-error{% else %}alert-info{% endif %}" style="margin-bottom: 0.5rem;">
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- é”™è¯¯ä¿¡æ¯ -->
    {% if result.error_message %}
    <div class="alert alert-error">
        <h4>âŒ é”™è¯¯</h4>
        <p>{{ result.error_message }}</p>
    </div>
    {% endif %}

    <!-- æ“ä½œæŒ‰é’® -->
    <div style="margin-top: 2rem;">
        <a href="{{ url_for('upload_page') }}" class="btn btn-primary">ç»§ç»­ä¸Šä¼ </a>
        {% if result.extracted_data %}
        <a href="{{ url_for('generate_page') }}" class="btn btn-success">ç”Ÿæˆç”³è¯·ä¹¦</a>
        {% endif %}
        <a href="{{ url_for('database_page') }}" class="btn btn-secondary">æŸ¥çœ‹æ•°æ®åº“</a>
    </div>
</div>

<!-- å¤„ç†çš„æ–‡ä»¶åˆ—è¡¨ -->
<div class="card">
    <h3>å¤„ç†çš„æ–‡ä»¶</h3>
    <ul style="margin-top: 1rem; padding-left: 2rem;">
        {% for file in files %}
        <li>{{ file.filename }}</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
